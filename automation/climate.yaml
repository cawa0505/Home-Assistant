#################################################################
## Thermostat Automations
#################################################################

  #################################################################
  ## Thermostat offline
  #################################################################

    - alias: 'Thermostat offline'
      
      trigger:
        platform: state
        from: 'on'
        to: 'off'
        entity_id: binary_sensor.heating_thermostat_online
        for: '00:10:00'

      action:
      - service: notify.telegram
        data:
         message: 'Thermostat has been offline for 10 minutes - please check heating'  

  ##########################################################
  ## Tado - Home
  ##########################################################

    #- alias: 'Tado - Home'
     # 
      #trigger:
       # platform: state
       # from: 'not_home'
       # to: 'home'
       # entity_id: group.household

      #action:
      #- service: climate.set_temperature
       # entity_id: climate.man_cave
        #data_template:
         # temperature: 21

  ##########################################################
  ## Tado - Away
  ##########################################################

    #- alias: 'Tado - Away'
     # 
      #trigger:
       # platform: state
        #from: 'home'
        #to: 'not_home'
        #entity_id: group.household

      #action:
      #- service: climate.set_temperature
       # entity_id: climate.man_cave
       # data_template:
        #  temperature: 10

        #########################################################
        ## Man Cave Door - Open & Sunset
        ##########################################################

  #  - alias: Man Cave Door - Open & Sunset
   #   
    #  trigger:
     #   platform: state
      #  entity_id: binary_sensor.man_cave_door
       # from: 'off'
        #to: 'on'

      #action:
      #- service: climate.set_temperature
      #  entity_id: climate.man_cave
       # data_template:
        #  temperature: 21  


        #########################################################
        ## Heating - Boost heating
        #########################################################

    - alias: 'Boost heating'
<<<<<<< HEAD
      
=======
      initial_state: off
>>>>>>> 18b6d154da0e7cce95a0345b9da92b651db2bb3d
      trigger:
        platform: state
        entity_id: sensor.tado_temp_met
        from: 'true'
        to: 'false'

   #   condition:
    #   - condition: state
     #    entity_id: group.household
      #   state: 'home' 

      action:
       - service: climate.set_preset_mode
         data:
           entity_id: climate.kitchen_thermostat
           preset_mode: "none"
       - service: climate.set_temperature
         entity_id: climate.kitchen_thermostat
         data_template:
           temperature: '{{ states("sensor.heating_current_temperature") | float + 2 }}'
       - service: homeassistant.toggle
         entity_id: input_boolean.boost_heating

        #########################################################
        ## Heating - Decrease heating
        #########################################################

    - alias: 'Decrease heating'
<<<<<<< HEAD
      
=======
      initial_state: off
>>>>>>> 18b6d154da0e7cce95a0345b9da92b651db2bb3d
      trigger:
        platform: state
        entity_id: sensor.tado_temp_met
        from: 'false'
        to: 'true'

  #   condition:
   #    - condition: state
    #     entity_id: group.household
     #    state: 'home'          

      action:
       - service: climate.set_temperature
         entity_id: climate.kitchen_thermostat
         data_template:
            temperature: '{{ states("sensor.heating_current_temperature") | float -2 }}'
       - service: homeassistant.toggle
         entity_id: input_boolean.boost_heating
       - service: climate.set_preset_mode
         data:
           entity_id: climate.kitchen_thermostat
           preset_mode: "eco"

        #########################################################
        ## Heating - Check if min temperature is met when household changes to home
        #########################################################

<<<<<<< HEAD
    - alias: 'Check heating min temp when arrive home'
      
=======
    - alias: 'Check heating min temp'
      initial_state: off
>>>>>>> 18b6d154da0e7cce95a0345b9da92b651db2bb3d
      trigger:
        platform: state
        from: 'not_home'
        to: 'home'
        entity_id: group.household

      condition:
       - condition: state
         entity_id: sensor.tado_temp_met
         state: 'false'    

      action:
      - service: climate.set_preset_mode
        data:
          entity_id: climate.kitchen_thermostat
          preset_mode: "none"
      - service: climate.set_temperature
        entity_id: climate.kitchen_thermostat
        data_template:
           temperature: '{{ states("sensor.heating_current_temperature") | float + 2 }}'
      - service: homeassistant.toggle
        entity_id: input_boolean.boost_heating

        #########################################################
        ## Heating - Nest call for heat but Tado Temp met - Turn off
        #########################################################

    - alias: 'Check heating min temp when arrive home'
      
      trigger:
        platform: state
        from: 'idle'
        to: 'heating'
        entity_id: sensor.nest_heating_status

      condition:
      - condition: state
        entity_id: sensor.tado_temp_met
        state: 'true'    

      action:
      - service: climate.set_temperature
        entity_id: climate.kitchen_thermostat
        data_template:
          temperature: '{{ states("sensor.heating_current_temperature") | float - 2 }}'
      - service: climate.set_preset_mode
        data:
         entity_id: climate.kitchen_thermostat
         preset_mode: "eco"

        #########################################################
        ## Heating > Idle check Tado temp met
        #########################################################

    - alias: 'Heating > Idle check Tado temp met'
      
      trigger:
        platform: state
        from: 'heating'
        to: 'idle'
        entity_id: sensor.nest_heating_status

      condition:
      - condition: state
        entity_id: sensor.tado_temp_met
        state: 'false'    

      action:
      - service: climate.set_preset_mode
        data:
          entity_id: climate.kitchen_thermostat
          preset_mode: "none"
      - service: climate.set_temperature
        entity_id: climate.kitchen_thermostat
        data_template:
          temperature: '{{ states("sensor.heating_current_temperature") | float + 2 }}'